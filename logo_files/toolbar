Toolbar=function(n){var t=this;t.dom;t.drawningboard=n;t.bgpicker;t.dominantpicker;t.enabled=!0;t.uploadnote;t.addicondialog;t.save;t.start=function(){t.dom=$("#toolbar");t.bgpicker=$(".background-picker");t.dominantpicker=$(".dominant-picker");t.languagepicker=$(".toolbar-language-select");t.save=t.dom.find(".confirm");t.save.on("click",function(){t.drawningboard.isSaveDisabled()||(t.drawningboard.isSave=!0,t.drawningboard.updateTextElements(),t.drawningboard.flowtab.preview())});t.drawningboard.formatsvg(t.dom);t.bgpicker.colpick({backgroundPicker:!0,id:"bg",onUseBackground:function(n){t.drawningboard.showbackground=n},onChange:function(n,i,r,u,f){$(f).find(".colorpicker").css("background-color","rgba("+u.r+","+u.g+","+u.b+","+u.a+")");t.drawningboard.background&&(t.drawningboard.background.color.colorlist[0].color="rgba("+u.r+","+u.g+","+u.b+","+u.a+")",t.drawningboard.background.update())},onSubmit:function(){t.drawningboard.selector.changed=1;t.drawningboard.background.update();t.drawningboard.selector.save()},onHide:function(){t.drawningboard.selector.changed=1;t.drawningboard.background.update();t.drawningboard.selector.save()}}).colpickSetOriginal($.colpick.stringToRgba("rgba(255, 255, 255, 0.25)")).colpickSetColor($.colpick.stringToRgba("rgba(255, 255, 255, 0.25)"));t.dominantpicker.colpick({id:"dominant",onChange:function(n,i,r,u,f){$(f).find(".colorpicker").css("background-color","rgba("+u.r+","+u.g+","+u.b+","+u.a+")");t.drawningboard.dominantcolor="rgba("+u.r+","+u.g+","+u.b+","+u.a+")"},onSubmit:function(){t.drawningboard.selector.changed=1;t.drawningboard.background.update();t.drawningboard.selector.save()},onHide:function(){t.drawningboard.selector.changed=1;t.drawningboard.background.update();t.drawningboard.selector.save()}}).colpickSetOriginal($.colpick.stringToRgba(t.dominantpicker.find(".colorpicker").css("background-color")));t.registerevents()};t.setdominantcolor=function(n){t.dominantpicker.colpickSetColor($.colpick.stringToRgba(n))};t.disable=function(){t.dom.addClass("disabled");t.enabled=!1};t.enable=function(){t.dom.removeClass("disabled");t.enabled=!0};t.finish=function(){t.dom.empty()};t.drawinitialelements=function(){t.addlogo()};t.addtext=function(){t.drawningboard.selector.explodedmode&&t.drawningboard.selector.endexplodedmode();var n=new Gradient;n.colorlist.push(new Color("rgba(0, 0, 0, 1)"));t.drawningboard.clipid++;text=new Text("New Text",Textformat.defaultFont,.5,n,t.drawningboard,null,null,t.drawningboard.clipid);text.start();t.setnewclipstate(text);setTimeout(function(){t.drawningboard.contexttab.focustextinput()},500);t.drawningboard.selector.select([text],!0);t.drawningboard.selector.changed=1;t.drawningboard.selector.save();t.drawningboard.selector.explodedmode&&t.drawningboard.selector.endexplodedmode();t.drawningboard.enableSave()};t.addshape=function(){t.drawningboard.selector.explodedmode&&t.drawningboard.selector.endexplodedmode();var n=new AddDialog(t.drawningboard,"shape");n.show()};t.addlogo=function(){t.drawningboard.selector.explodedmode&&t.drawningboard.selector.endexplodedmode();var n=new AddDialog(t.drawningboard,"logo");n.show()};t.addicon=function(){t.drawningboard.selector.explodedmode&&t.drawningboard.selector.endexplodedmode();t.addicondialog?t.addicondialog.back():(t.addicondialog=new AddDialog(t.drawningboard,"icon"),t.addicondialog.show())};t.addsvg=function(){$("#admin-upload").click()};t.inserttext=function(n,i,r,u,f,e,o,s,h,c){return clip1=new Text(n,i,s,o,t.drawningboard,r,u,t.drawningboard.clipid),clip1.format.size=h,clip1.offset.x=f,clip1.offset.y=e,clip1.subid=c,clip1.start(),t.drawningboard.selector.setnewclipstate(clip1),clip1};t.insertclip=function(n,i,r,u,f,e,o,s,h){return clip1=new Clip(n[0],e,t.drawningboard,i,r,t.drawningboard.clipid,s,null,u,f,o),clip1.note=h,clip1.start(),t.drawningboard.selector.setnewclipstate(clip1),t.drawningboard.clipid++,clip1};t.startownermode=function(){t.bgpicker.hide()};t.reviewicon=function(){var n=new ReviewDialog(t.drawningboard);n.show()};t.getColor=function(n,t,i){var e=new Gradient,r=$(n).attr("fill"),u,f,s,o;if(r||(r=$(n).css("fill")),r)if(r=="none")r="rgba(255,255,255,0)",e.colorlist.push(new Color(r));else if(r.indexOf("url(")==0)if(u=r.replace("url(","").replace(")",""),u=u.replace(document.URL,""),u=u.replace("'","").replace("'",""),u=u.replace('"',"").replace('"',""),u=u.replace("transparent",""),u=u.replace(" ",""),f=$(i).find(u),f[0].toString()=="[object SVGRadialGradientElement]")r="#000000",e.colorlist.push(new Color(r));else{var h=f.attr("x1"),c=f.attr("y1"),l=f.attr("x2"),a=f.attr("y2"),v=calc.getAngleOfPoints(h,c,l,a);e.rotation=parseInt(v);f.attr("xlink:href")?(s=$(i).find(f.attr("xlink:href")),o=s.find("stop")):o=f.find("stop");$.each(o,function(n,i){var r=$(i).css("stop-opacity"),u;r||(r=1);r*=t.opacity;u=new Color($(i).css("stop-color"),r);u.position=parseFloat($(i).attr("offset"))*100;e.colorlist.push(u)})}else e.colorlist.push(new Color(r,t.opacity));else r="#000000",e.colorlist.push(new Color(r,t.opacity));return e};t.proccesssvg=function(n,i){var f=$(n),r,u;t.drawningboard.selector.target=[];$.each(f,function(n,r){var e=r,u,f;if($("body").append(e),r.toString()=="[object SVGSVGElement]"){r.innerHTML.indexOf("http://thenounproject.com")!=-1&&$(r).find("g")[0].remove();u=$(r).attr("width")!="100%"&&$(r).attr("width")?parseInt($(r).attr("width"))+10:300;f=$(r).attr("height")!="100%"&&$(r).attr("height")?parseInt($(r).attr("height"))+10:300;var h=$(r).find("defs").clone(),s=u>f?f:u,o=300/s;$(r).find("#Captions").remove();$(r).find("#Polka_Dot_Pattern").remove();$(r).find("marker").remove();$.each($(r).find("path, polygon, circle, rect, ellipse"),function(n,r){var v=Utils.getparentbox(r),c,l,h,s;if($(r).parent()[0].toString()!="[object SVGClipPathElement]"){c=$(r).parent().attr("fill-rule");c&&$(r).attr("fill-rule",c);l=$("<svg width='"+u+"' height='"+f+"'><\/svg>");h=Snap(l[0]);h.add(r.cloneNode(!0));s=h.selectAll("path, polygon, circle, rect, ellipse, polyline").getBBox();h.attr({viewBox:""+(s.x-5)+","+(s.y-5)+","+(s.width+10)+","+(s.height+10),width:s.width+10,height:s.height+10});var y=t.getColor(r,v,e),p=s.cx,w=s.cy,a=t.insertclip($(l),p,w,u,f,y,o,undefined,t.uploadnote);a.nounId=i;t.drawningboard.selector.target.push(a)}});$.each($(r).find("text, tspan"),function(n,i){var d=Utils.getparentbox(i),v,y,p,s,h,r,c,a,w,b,tt,k;if($(i).parent()[0].toString()!="[object SVGClipPathElement]"&&$(i).parent()[0].toString()!="[object SVGTextElement]"){v=$("<svg width='"+u+"' height='"+f+"'><\/svg>");y=Snap(v[0]);y.add(i.cloneNode(!0));p=t.getColor(i,d,e);s=$(i).attr("font-family");s||(s=$(i).css("font-family"));s||(s=Textformat.defaultFont);h=$(i).text();try{$(h)[0]&&$(h)[0].tagName=="TSPAN"&&(h=$(h).text())}catch(it){}var l=i.getBBox(),g=l.x+l.width/2,nt=l.y+l.height/2,r=$(i).attr("font-size");r||(r=$(i).css("font-size"));c=$(i).attr("transform");c&&(c.indexOf(",")>0?a=",":c.indexOf(" ")>0&&(a=" "),transformArray=c.slice(7,-1).split(a),w=parseFloat(transformArray[1]),b=parseFloat(transformArray[2]),b,w);r=parseInt(r);tt=o*(r/100);k=t.inserttext(h,s,g,nt,u,f,p,o,r);t.drawningboard.selector.target.push(k)}});$(e).remove();t.drawningboard.selector.group()}});r=t.drawningboard.selector.target;t.drawningboard.selector.changed=1;t.drawningboard.selector.save();t.drawningboard.selector.select(r,!0);t.drawningboard.selector.center();setTimeout(function(){t.drawningboard.selector.refreshindex();t.drawningboard.selector.unselect();t.drawningboard.selector.select(r,!0);t.drawningboard.selector.center();t.drawningboard.selector.unselect()},1);u=t.dom.find("#admin-upload");u.length>0&&(u.wrap("<form>").closest("form").get(0).reset(),t.dom.find("#admin-upload").unwrap())};t.uploadsvg=function(n){var i=prompt("Please enter the note:");t.uploadnote=i!=null&&i!=""?i:undefined;t.drawningboard.clipid++;t.drawningboard.selector.target=[];$.each(n,function(n,i){var r=new FileReader;r.onload=function(){return function(n){var i=n.target.result;t.proccesssvg(i)}}(i);r.readAsText(i)})};t.changelanguage=function(){var i=t.languagepicker.find("select").val().toLowerCase(),r=(location.href.indexOf("?lang")<0?"&":"?")+"lang="+i,n=location.href.replace(/(?:&|\?)?lang=[A-Za-z]+/gi,r);n.indexOf(r)<0&&(n+="?lang="+i);location.href=n};t.uploaddialog=function(n){t.uploadsvg(n.target.files)};t.registerevents=function(){t.dom.find(".addtext").on("click",t.addtext);t.dom.find(".addshape").on("click",t.addshape);t.dom.find(".addlogo").on("click",t.addlogo);t.dom.find(".addicon").on("click",t.addicon);t.dom.find(".addsvg").on("click",t.addsvg);t.dom.find("#admin-upload").on("change",t.uploaddialog);t.dom.find(".reviewlogo").on("click",t.reviewicon);var n=t.languagepicker.find("select");n.on("change",t.changelanguage);t.drawningboard.api.getLanguageList(function(i){$.each(i,function(t,i){n.append("<option value="+i.code+">"+i.code+"<\/option>")});n.val(t.drawningboard.api.language.toUpperCase())})};t.setnewclipstate=function(n){t.drawningboard.selector.setnewclipstate(n)};t.start()}