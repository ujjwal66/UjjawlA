Flowtab=function(n){var t=this;t.dom;t.drawningboard=n;t.previewdialog;t.start=function(){t.dom=$(".flowtab-wrapper");t.registerEvents();t.drawningboard.formatsvg(t.dom)};t.checkdisables=function(){t.drawningboard.currentstate>0?t.dom.find(".undo").removeClass("disabled"):t.dom.find(".undo").addClass("disabled");t.drawningboard.currentstate<t.drawningboard.background.statelist.length-1?t.dom.find(".redo").removeClass("disabled"):t.dom.find(".redo").addClass("disabled")};t.pushstate=function(){$.each(t.drawningboard.cliplist,function(n,t){t.pushstate()});t.drawningboard.background.pushstate();t.drawningboard.currentstate++;t.checkdisables()};t.undo=function(){t.drawningboard.currentstate>0&&(t.drawningboard.currentstate--,t.drawningboard.selector.unselect(),$.each(t.drawningboard.cliplist,function(n,t){t.undo()}),t.drawningboard.background.undo(),t.drawningboard.selector.refreshindex(),t.drawningboard.contexttab.undo(),t.animation.undo(),t.drawningboard.validateData());t.checkdisables()};t.redo=function(){t.drawningboard.currentstate<t.drawningboard.background.statelist.length-1&&(t.drawningboard.currentstate++,t.drawningboard.selector.unselect(),$.each(t.drawningboard.cliplist,function(n,t){t.redo()}),t.drawningboard.background.redo(),t.drawningboard.selector.refreshindex(),t.drawningboard.contexttab.redo(),t.animation.redo(),t.drawningboard.validateData());t.checkdisables()};t.finish=function(){t.dom.remove()};t.reset=function(){var n=new Messagebox(t.drawningboard,t.drawningboard.api.dictionary.flowtab_reset_confirmation,t.resetCall,t.drawningboard.api.dictionary.reset,t.drawningboard.api.dictionary.cancel);n.show()};t.resetCall=function(){t.drawningboard.reset();t.drawningboard.enableSave()};t.preview=function(){t.drawningboard.isSaveDisabled()||(t.previewdialog=new Previewdialog(t.drawningboard),t.previewdialog.start(),t.animation.preview())};t.inputing=function(){var n=document.activeElement;return n&&(n.tagName.toLowerCase()=="input"&&n.type=="text"||n.tagName.toLowerCase()=="textarea")?!0:!1};t.registerEvents=function(){var n="touchstart click";t.dom.find(".reset").on(n,function(n){n.preventDefault();t.reset()});t.dom.find(".undo").on(n,function(n){n.preventDefault();t.undo()});t.dom.find(".redo").on(n,function(n){n.preventDefault();t.redo()});t.dom.find(".preview").on(n,function(n){t.drawningboard.isSave=!0;n.preventDefault();t.preview()});$("body").keybind("keydown",{"C-z":function(n){t.inputing()||(n.preventDefault(),t.undo())},"C-y":function(n){t.inputing()||(n.preventDefault(),t.redo())},"C-a":function(n){t.inputing()||(n.preventDefault(),t.drawningboard.selector.selectall())},"M-a":function(n){t.inputing()||(n.preventDefault(),t.drawningboard.selector.selectall())},"S-z":function(n){t.inputing()||(n.preventDefault(),t.undo())},"S-y":function(n){t.inputing()||(n.preventDefault(),t.redo())},"S-a":function(n){t.inputing()||(n.preventDefault(),t.drawningboard.selector.selectall())},"return":function(){t.drawningboard.confirmmessage();t.drawningboard.contexttab.fontliststate&&t.drawningboard.contexttab.fontenter()},up:function(){t.drawningboard.contexttab.fontliststate?t.drawningboard.contexttab.fontup():t.inputing()||t.drawningboard.selector.moveup(1)},down:function(){t.drawningboard.contexttab.fontliststate?t.drawningboard.contexttab.fontdown():t.inputing()||t.drawningboard.selector.movedown(1)},left:function(){t.inputing()||t.drawningboard.selector.moveleft(1)},right:function(){t.inputing()||t.drawningboard.selector.moveright(1)},"S-up":function(){t.inputing()||t.drawningboard.selector.moveup(10)},"S-down":function(){t.inputing()||t.drawningboard.selector.movedown(10)},"S-left":function(){t.inputing()||t.drawningboard.selector.moveleft(10)},"S-right":function(){t.inputing()||t.drawningboard.selector.moveright(10)},"C-c":function(){t.inputing()||t.drawningboard.selector.copy()},"C-v":function(){t.inputing()||t.drawningboard.selector.paste()},"C-d":function(){if(!t.inputing())return t.drawningboard.selector.copy(),t.drawningboard.selector.paste(),!1},"C-g":function(){if(!t.inputing())return t.drawningboard.selector.group(),!1},escape:function(){t.drawningboard.selector.unselect();t.previewdialog&&t.previewdialog.return();t.drawningboard.messagemenu&&t.drawningboard.messagemenu.hide()},"delete":function(n){t.inputing()||(n.preventDefault(),t.drawningboard.selector.delete())},backspace:function(n){t.inputing()||(n.preventDefault(),t.drawningboard.selector.delete())}})};t.animation=function(){};t.animation.undo=function(){t.dom.find(".undo svg").css("textIndent",720);t.dom.find(".undo svg").stop().animate({textIndent:0},{duration:500,step:function(n,i){i.prop=="textIndent"&&(t.dom.find(".undo svg").css("-webkit-transform","rotate("+n+"deg)"),t.dom.find(".undo svg").css("-ms-transform","rotate("+n+"deg)"),t.dom.find(".undo svg").css("-moz-transform","rotate("+n+"deg)"))},complete:function(){}})};t.animation.redo=function(){t.dom.find(".redo svg").css("textIndent",0);t.dom.find(".redo svg").stop().animate({textIndent:720},{duration:500,step:function(n,i){i.prop=="textIndent"&&(t.dom.find(".redo svg").css("-webkit-transform","rotate("+n+"deg)"),t.dom.find(".redo svg").css("-ms-transform","rotate("+n+"deg)"),t.dom.find(".redo svg").css("-moz-transform","rotate("+n+"deg)"))},complete:function(){}})};t.animation.preview=function(){t.dom.find(".preview svg").stop().slideUp("fast",function(){t.dom.find(".preview svg").slideDown("fast")})};t.start()}