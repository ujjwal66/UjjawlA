Colorbox=function(n,t,i,r){var u=this;u.tab=n;u.dom=$('<div class="color-picker"><div class="color-picker-color"><\/div><\/div>');u.colordom=u.dom.find(".color-picker-color");u.context=t;u.color=i;u.originalcolor;u.dragging=!1;u.isgradient=r;u.target=u.tab.target;u.autoopen=!1;u.event;u.delete=function(){$.each(u.tab.color.colorlist,function(n){if(u.tab.color.colorlist[n]==u.color)return u.tab.color.colorlist.splice(n,1),!1});u.tab.updatecolor();u.tab.updatepreview();u.tab.drawningboard.selector.changed=1;u.tab.drawningboard.selector.save();u.tab.color.colorlist.length==1&&u.tab.select([u.target]);u.colordom.parent().remove();u.tab.drawningboard.isFirefox&&u.tab.drawningboard.selector.refreshindex()};u.start=function(){u.originalcolor=u.color.color?u.color.color.replaceAll(" ",""):undefined;u.context.prepend(u.dom);u.color.color?u.colordom.css("background-color",u.color.color):u.colordom.parent().css("background-image","url('Content/img/bgempty.png')");u.dom.css("left",211/100*u.color.position);var n=u.colordom.colpick({showdelete:r,onChange:function(n,t,i,r,f){u.colordom.parent().css("background-image","url('Content/img/bg.png')");$(f).css("background-color","rgba("+r.r+","+r.g+","+r.b+","+r.a+")");r?(u.color.color="rgba("+r.r+","+r.g+","+r.b+","+r.a+")",u.tab.updatecolor(),u.tab.updatepreview()):u.color.color=undefined;u.tab.drawningboard.isFirefox&&u.tab.drawningboard.selector.refreshindex()},onSubmit:function(){u.color.color!=u.originalcolor&&u.color.color!=undefined&&(u.originalcolor=u.color.color.replaceAll(" ",""),u.tab.drawningboard.selector.changed=1,u.tab.drawningboard.selector.save())},onHide:function(){u.color.color!=u.originalcolor&&u.color.color!=undefined&&(u.originalcolor=u.color.color.replaceAll(" ",""),u.tab.drawningboard.selector.changed=1,u.tab.drawningboard.selector.save())},onDelete:function(n,t){u.delete();$(t).remove()},onBeforeShow:function(n){u.tab.currentpanel.find(".textbox input").blur();u.dragging?(n.dragging=!0,u.dragging=!1):n.dragging=!1}});if(u.color.color?n.colpickSetOriginal($.colpick.stringToRgba(u.color.color)):n.colpickSetOriginal(undefined),u.isgradient){u.dom.draggable({containment:"parent"});u.dom.on("drag",function(n,t){var i=t.position.left/211*100,r=t.position.top-10;i<0&&(i=0);i>100&&(i=100);r>20||r<-40?u.dom.css("opacity",.3):u.dom.css("opacity",1);u.color.position=i;u.tab.updatecolor();u.tab.updatepreview();u.dragging=!0;u.tab.drawningboard.isFirefox&&u.tab.drawningboard.selector.refreshindex()});u.dom.on("dragstop",function(n,t){u.tab.drawningboard.selector.changed=1;u.tab.drawningboard.selector.save();var i=t.position.top-10;i>20||i<-40?u.dom.animate({opacity:0},"fast",function(){u.delete()}):u.dom.animate({top:10},"fast");setTimeout(function(){u.dragging=!1},50)});u.dom.on("dragstart",function(n){var t,i;n.ctrlKey&&(t=new Color(u.color.color),t.position=u.color.position,u.tab.color.colorlist.push(t),i=new Colorbox(u.tab,u.tab.currentpanel.find(".multiple-track"),t,!0),i.start())})}u.dom.on("contextmenu",function(){return!1});u.autoopen&&setTimeout(function(){u.colordom.trigger("click")},100)}}