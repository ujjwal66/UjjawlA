ReviewDialog=function(n){var t=this;t.drawningboard=n;t.dom;t.SvgTools=new SvgTools;t.category;t.status;t.owner;t.priority;t.search;t.category_select1;t.category_select2;t.category_select3;t.status_select;t.owner_select;t.priority_select;t.objownerlist;t.objcategorylist;t.objiconlist;t.edit;t.exit;t.close;t.next;t.save;t.currentpage=1;t.dom=$(".review-dialog");t.show=function(){t.dom.fadeIn(200);t.drawningboard.messagemenu=t;t.category=t.dom.find(".selection-menu .category select");t.status=t.dom.find(".selection-menu .status select");t.owner=t.dom.find(".selection-menu .owner select");t.search=t.dom.find(".selection-menu .search");t.exit=t.dom.find(".selection-menu .close");t.category_select1=t.dom.find(".lateral-menu .category-1 select");t.category_select2=t.dom.find(".lateral-menu .category-2 select");t.category_select3=t.dom.find(".lateral-menu .category-3 select");t.status_select=t.dom.find(".lateral-menu .status select");t.owner_select=t.dom.find(".lateral-menu .owner select");t.priority_select=t.dom.find(".lateral-menu .priority select");t.edit=t.dom.find(".lateral-menu .buttons .edit");t.close=t.dom.find(".lateral-menu .buttons .close");t.next=t.dom.find(".lateral-menu .buttons .next");t.save=t.dom.find(".lateral-menu .buttons .save");t.wrapper=t.dom.find(".body .list .list-wrapper");t.load=t.dom.find(".body .load");t.registerevents();t.loadowners();t.loadcategories();t.startsearch()};t.loadowners=function(){$.ajax({type:"post",url:t.drawningboard.api.owner+"list",dataType:"json"}).done(function(n){t.objownerlist=n.obj;$.each(t.objownerlist,function(n,i){var r=$("<option>"+i.key+"<\/option>"),u=$("<option>"+i.key+"<\/option>");r.attr("value",i.id);u.attr("value",i.id);t.owner.append(r);t.owner_select.append(u)})}).fail(function(){t.requesterror()})};t.requesterror=function(){if(!t.category_select1.val()&&!t.category_select2.val()&&!t.category_select3.val()){var n=new Messagebox(t.drawningboard,"Error requesting information from the server, please try again.",null,null,"ok",t.hide);n.show();return}};t.loadcategories=function(){$.ajax({type:"post",url:t.drawningboard.api.category+"list",data:JSON.stringify({status:t.status.val(),owner:t.owner.val()}),dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(n){var r,i,u;t.category.find("option").remove();var f=t.category.val(),e=t.category_select1.val(),o=t.category_select2.val(),s=t.category_select3.val();t.category_select1.find("option").remove();t.category_select2.find("option").remove();t.category_select3.find("option").remove();r=$("<option>All<\/option>");i=$("<option><\/option>");r.attr("value",0);t.category.append(r);t.category_select1.append(i);t.category_select2.append(i.clone());t.category_select3.append(i.clone());n.obj&&n.obj.length>0&&($.each(n.obj,function(n,i){i.description=t.drawningboard.api.dictionary["category_"+i.id];i.description==undefined&&(i.description="undefined")}),u=n.obj,u.sort(function(n,t){return n.description.toUpperCase()>t.description.toUpperCase()?1:n.description<t.description?-1:void 0}),t.objcategorylist=u,$.each(t.objcategorylist,function(n,i){var u=$("<option>"+i.description+" ("+i.qtd+")<\/option>"),r=$("<option>"+i.description+"<\/option>");u.attr("value",i.id);r.attr("value",i.id);i.qtd>0&&t.category.append(u);t.category_select1.append(r);t.category_select2.append(r.clone());t.category_select3.append(r.clone());i.subcategory&&$.each(i.subcategory,function(n,i){var u=$("<option>- "+i.description+" ("+i.qtd+")<\/option>"),r=$("<option>- "+i.description+"<\/option>");u.attr("value",i.id);r.attr("value",i.id);i.qtd>0&&t.category.append(u);t.category_select1.append(r);t.category_select2.append(r.clone());t.category_select3.append(r.clone())})}));t.category.val(f);t.category_select1.val(e);t.category_select2.val(o);t.category_select3.val(s)}).fail(function(){t.requesterror()})};t.startsearch=function(){t.closeedit();t.load.fadeIn("fast");t.category_select1.val("");t.category_select2.val("");t.category_select3.val("");t.category_select1.tooltip({content:""});t.category_select2.tooltip({content:""});t.category_select3.tooltip({content:""});t.status_select.val("");t.owner_select.val("");t.priority_select.val("");$.ajax({type:"post",url:t.drawningboard.api.logo+"list",data:JSON.stringify({page:t.currentpage,category:t.category.val(),owner:t.owner.val(),status:t.status.val(),pagesize:18}),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){if(t.wrapper.empty(),n.vars.pages>1){if(t.dom.find(".totalpage").html(n.vars.pages),t.dom.find(".curpage").html(n.vars.curpage),t.dom.find(".pagination-wrapper").css("visibility","visible"),t.dom.find(".pagination-wrapper .next").unbind("mouseup"),t.dom.find(".pagination-wrapper .previous").unbind("mouseup"),n.vars.pages>n.vars.curpage){t.dom.find(".pagination-wrapper .next").removeClass("disabled");t.dom.find(".pagination-wrapper .next").on("mouseup",function(){t.nextpage()})}else t.dom.find(".pagination-wrapper .next").addClass("disabled");if(n.vars.curpage>1){t.dom.find(".pagination-wrapper .previous").removeClass("disabled");t.dom.find(".pagination-wrapper .previous").on("mouseup",function(){t.prevpage()})}else t.dom.find(".pagination-wrapper .previous").addClass("disabled")}else t.dom.find(".pagination-wrapper").css("visibility","hidden");if(n.obj){t.objiconlist=n.obj;$.each(t.objiconlist,function(n,i){var r=$('<div class="item"><\/div>'),u=t.SvgTools.getthumb(i);r.append(u.svg);r.attr("svgid",i.id);t.wrapper.append(r)});var i=t.dom.find(".list .item");i.on("mouseup",function(){var o,f,n,r,u,e;$(this).hasClass("selected")?t.openedit():(t.closeedit(),i.removeClass("selected"),$(this).addClass("selected"),o=$(".lateral-menu .id span"),f=$(this).attr("svgid"),o.html("ID "+f),n=$.grep(t.objiconlist,function(n){return n.id==f})[0],t.status_select.val(n.status),t.owner_select.val(n.owner_id),t.priority_select.val(n.priority),r=[],$.each(n.shape_list,function(n,t){r.indexOf(t.note)==-1&&r.push(t.note)}),u="",$.each(r,function(n,t){u+=t+" "}),u.trim()?($(".lateral-menu .id .fa").attr("title",u),$(".lateral-menu .id .fa").show()):$(".lateral-menu .id .fa").hide(),e=1,n.category_list&&$.each(n.category_list,function(n,t){var i=$(".lateral-menu .category-"+e+" select");i.val(t.id);i.tooltip({content:i.find(":selected").text()});e++}))})}t.load.fadeOut("fast")}).fail(function(){t.requesterror()})};t.nextpage=function(){t.currentpage=parseInt(t.dom.find(".curpage").html())+1;t.startsearch()};t.prevpage=function(){t.currentpage=parseInt(t.dom.find(".curpage").html())-1;t.startsearch()};t.nextedit=function(){var n;if(!t.category_select1.val()&&!t.category_select2.val()&&!t.category_select3.val()){n=new Messagebox(t.drawningboard,"You can't save without choosing a category.",null,null,"ok");n.show();return}if(!t.status_select.val()){n=new Messagebox(t.drawningboard,"You can't save without choosing a status.",null,null,"ok");n.show();return}t.load.fadeIn("fast");$.ajax({type:"post",url:t.drawningboard.api.logo+"update",data:JSON.stringify(t.getsaveenvelope()),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){t.load.fadeOut("fast");t.dom.find(".msgbox").css("opacity",1);setTimeout(function(){t.dom.find(".msgbox").css("opacity",0)},2e3);t.nexticon[0]&&(t.nexticon.trigger("mouseup"),t.nexticon.trigger("mouseup"))}).fail(function(){t.requesterror()});t.closeedit()};t.getsaveenvelope=function(){var i=$(".list .item.selected"),r=i.attr("svgid"),n={};return n.id=r,n.owner_id=t.owner_select.val(),n.status=t.status_select.val(),n.category_list=[],n.priority=t.priority_select.val(),t.category_select1.val()&&n.category_list.push({id:t.category_select1.val()}),t.category_select2.val()&&n.category_list.push({id:t.category_select2.val()}),t.category_select3.val()&&n.category_list.push({id:t.category_select3.val()}),{logo:n,loginKey:t.drawningboard.ownerloginkey}};t.saveedit=function(){var n;if(!t.category_select1.val()&&!t.category_select2.val()&&!t.category_select3.val()){n=new Messagebox(t.drawningboard,"You can't save without choosing a category.",null,null,"ok");n.show();return}if(!t.status_select.val()){n=new Messagebox(t.drawningboard,"You can't save without choosing a status.",null,null,"ok");n.show();return}if(!t.priority_select.val()){n=new Messagebox(t.drawningboard,"You can't save without choosing a priority.",null,null,"ok");n.show();return}t.load.fadeIn("fast");$.ajax({type:"post",url:t.drawningboard.api.logo+"update",data:JSON.stringify(t.getsaveenvelope()),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(){t.closeedit();t.loadcategories();t.startsearch()}).fail(function(){t.requesterror()})};t.submitedit=function(){};t.rollbackedit=function(){t.closeedit();t.loadcategories();t.startsearch()};t.closeedit=function(){$(".lateral-menu .id span").html("ID ");$(".lateral-menu .id .fa").hide();$(".lateral-menu .buttons .disabled").removeClass("disabled");t.next.addClass("disabled");t.close.addClass("disabled");t.save.addClass("disabled");$(".list .item").removeClass("selected");t.category_select1.val("");t.category_select2.val("");t.category_select3.val("");t.status_select.val("");t.owner_select.val("");$(".lateral-menu .lateral-container .fa").hide();$(".lateral-menu .lateral-container select").attr("disabled","disabled");var n=$(".body .item-detail");n.remove();$(".review-window .body .list").show();$(".review-window .body .pagination").show()};t.openedit=function(){var i=$(".list .item.selected");if(i[0]){t.nexticon=i.next();$(".lateral-menu .buttons .disabled").removeClass("disabled");t.edit.addClass("disabled");$(".lateral-menu .lateral-container select").removeAttr("disabled");$(".lateral-menu .lateral-container .fa").show();t.nexticon[0]?t.next.removeClass("disabled"):t.next.addClass("disabled");var n=$("<div class='item-detail'><\/div>"),r=i.attr("svgid"),u=$.grep(t.objiconlist,function(n){return n.id==r})[0],f=t.SvgTools.getthumb(u);n.append(f.svg);n.find(".thumb").css("width","90%");n.find(".thumb").css("height","90%");n.find(".thumb").css("margin","21px");$(".review-window .body").append(n);$(".review-window .body .list").hide();$(".review-window .body .pagination").hide()}};t.registerevents=function(){t.exit.off("mouseup");t.exit.on("mouseup",function(){t.hide()});t.category.off("change");t.category.on("change",function(){t.currentpage=1;t.startsearch()});t.dom.find(".lateral-menu select").off("change").on("change",function(){$(this).tooltip({content:$(this).find(":selected").text()})});t.status.off("change");t.status.on("change",function(){t.currentpage=1;t.loadcategories();t.startsearch()});t.owner.off("change");t.owner.on("change",function(){t.currentpage=1;t.loadcategories();t.startsearch()});t.edit.off("mouseup");t.edit.on("mouseup",function(){t.openedit()});t.close.off("mouseup");t.close.on("mouseup",function(){t.rollbackedit()});t.save.off("mouseup");t.save.on("mouseup",function(){t.saveedit()});t.next.off("mouseup");t.next.on("mouseup",function(){t.nextedit()});t.dom.find(".lateral-menu .category-1 .fa").off("click").on("click",function(){t.category_select1.val(0)});t.dom.find(".lateral-menu .category-2 .fa").off("click").on("click",function(){t.category_select2.val(0)});t.dom.find(".lateral-menu .category-3 .fa").off("click").on("click",function(){t.category_select3.val(0)})};t.hide=function(){t.dom.fadeOut(200,function(){t.drawningboard.messagemenu=undefined})}}