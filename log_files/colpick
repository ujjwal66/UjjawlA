(function(n){colpick=function(t){var o=this;o.drawningboard=t;n.widget("ui.pctspinner",n.ui.spinner,{options:{max:100,min:0,step:1,spin:function(t,i){var r={cal:n(t.currentTarget).parent().parent().parent()};r.cal.find(".colpick_alpha_slider").slider("value",i.value);r.cal.data("colpick")!=undefined&&n(r.cal.data("colpick").el).colpickSetOpacity(parseFloat(i.value/100))},change:function(t){var i={cal:n(t.currentTarget).parent().parent().parent()};parseInt(n(this).val())<0?n(this).val("0%"):parseInt(n(this).val())>100?n(this).val("100%"):isNaN(parseInt(n(this).val()))&&n(this).val("100%");i.cal.find(".colpick_alpha_slider").slider("value",n(this).val());n(i.cal.data("colpick").el).colpickSetOpacity(parseFloat(n(this).val())/100)},create:function(){n(this).on("blur",function(t){var i={cal:n(t.currentTarget).parent().parent().parent()};i.cal.find(".colpick_alpha_slider").slider("value",n(this).val());n(i.cal.data("colpick").el).colpickSetOpacity(parseFloat(n(this).val())/100)})}},_parse:function(n){return parseFloat(n)},_format:function(n){return n+"%"}});var v=n('<div class="colpick"><\/div>').append(n("#colpickTemplate").detach().html()),r=function(){var ct=n(v),lt=ct.outerHTML(),at={showEvent:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},onDelete:function(){},onUseBackground:function(){},colorScheme:"dark",color:"FFFFFF",livePreview:!1,flat:!1,layout:"hex",showdelete:!1,backgroundPicker:!1,submit:0,submitText:"OK",height:156,id:!1},y=new Date,d="touchstart click",t=function(t,i){var r=u(t);n(i).data("colpick").fields.eq(1).val(r.r).end().eq(2).val(r.g).end().eq(3).val(r.b).end()},a=function(t,i){t?n(i).data("colpick").fields.eq(4).val(Math.round(t.h)).end().eq(5).val(Math.round(t.s)).end().eq(6).val(Math.round(t.b)).end():n(i).data("colpick").fields.eq(4).val(0).end().eq(5).val(0).end().eq(6).val(0).end()},r=function(t,r){var u;u=t?i(t):"- - - - - -";n(r).data("colpick").fields.eq(0).val(u)},p=function(t,r){t||(t={h:0,s:0,b:0});n(r).data("colpick").selector.css("backgroundColor","#"+i({h:t.h,s:100,b:100}));n(r).data("colpick").selectorIndic.css({left:parseInt(n(r).data("colpick").height*t.s/100,10),top:parseInt(n(r).data("colpick").height*(100-t.b)/100,10)})},w=function(t,i){var r;r=t?t.h:0;n(i).data("colpick").hue.css("top",parseInt(n(i).data("colpick").height-n(i).data("colpick").height*r/360,10))},b=function(t,r){n(r).data("colpick").currentColor.css("backgroundColor","#"+i(t))},k=function(t,r){var u;t?(u="#"+i(t),n(r).data("colpick").newColorBg.css("background-image","url('Content/img/bg.png')")):(u="rgba(0, 0, 0, 0)",n(r).data("colpick").newColorBg.css("background-image","url('Content/img/bgpickempty.png')"));n(r).data("colpick").newColor.css("backgroundColor",u)},c=function(){var o=n(this).parent().parent(),h;this.parentNode.className.indexOf("_hex")>0?(o.data("colpick").color=h=s(ti(this.value)),t(h,o.get(0)),a(h,o.get(0))):this.parentNode.className.indexOf("_hsb")>0?(o.data("colpick").color=h=nt({h:parseInt(o.data("colpick").fields.eq(4).val(),10),s:parseInt(o.data("colpick").fields.eq(5).val(),10),b:parseInt(o.data("colpick").fields.eq(6).val(),10)}),t(h,o.get(0)),r(h,o.get(0))):(o.data("colpick").color=h=f(ni({r:parseInt(o.data("colpick").fields.eq(1).val(),10),g:parseInt(o.data("colpick").fields.eq(2).val(),10),b:parseInt(o.data("colpick").fields.eq(3).val(),10)})),r(h,o.get(0)),a(h,o.get(0)));h.a=parseInt(o.find(".colpick_alpha_field input").val())/100;p(h,o.get(0));w(h,o.get(0));k(h,o.get(0));o.data("colpick").onChange.apply(o.parent(),[h,i(h),u(h),e(h),o.data("colpick").el,0])},vt=function(){n(this).parent().removeClass("colpick_focus")},yt=function(){n(this).parent().parent().data("colpick").fields.parent().removeClass("colpick_focus");n(this).parent().addClass("colpick_focus")},pt=function(t){var i=n(this).parent().find("input").not(".colpick_alpha_input").focus(),r={el:n(this).parent().addClass("colpick_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:t.pageY,field:i,val:parseInt(i.val(),10),preview:n(this).parent().parent().data("colpick").livePreview};n(document).mouseup(r,it);n(document).mousemove(r,tt)},tt=function(n){return n.data.field.val(Math.max(0,Math.min(n.data.max,parseInt(n.data.val-n.pageY+n.data.y,10)))),n.data.preview&&c.apply(n.data.field.get(0),[!0]),!1},it=function(t){c.apply(t.data.field.get(0),[!0]);t.data.el.removeClass("colpick_slider").find("input").not(".colpick_alpha_input").focus();n(document).off("mouseup",it);n(document).off("mousemove",tt)},wt=function(t){var i,r;t.preventDefault?t.preventDefault():t.returnValue=!1;i={cal:n(this).parent(),y:n(this).offset().top};n(document).on("mouseup touchend",i,ut);n(document).on("mousemove touchmove",i,rt);r=t.type=="touchstart"?t.originalEvent.changedTouches[0].pageY:t.pageY;c.apply(i.cal.data("colpick").fields.eq(4).val(parseInt(360*(i.cal.data("colpick").height-(r-i.y))/i.cal.data("colpick").height,10)).get(0),[i.cal.data("colpick").livePreview])},rt=function(n){n.preventDefault?n.preventDefault():n.returnValue=!1;var t=n.type=="touchmove"?n.originalEvent.changedTouches[0].pageY:n.pageY;c.apply(n.data.cal.data("colpick").fields.eq(4).val(parseInt(360*(n.data.cal.data("colpick").height-Math.max(0,Math.min(n.data.cal.data("colpick").height,t-n.data.y)))/n.data.cal.data("colpick").height,10)).get(0),[n.data.preview])},ut=function(i){t(i.data.cal.data("colpick").color,i.data.cal.get(0));r(i.data.cal.data("colpick").color,i.data.cal.get(0));n(document).off("mouseup touchend",ut);n(document).off("mousemove touchmove",rt)},bt=function(t){var i,r,u;t.preventDefault?t.preventDefault():t.returnValue=!1;i={cal:n(this).parent(),pos:n(this).offset()};r=i.cal.data("colpick");i.preview=r.livePreview;r.selector.closest(".colpick").addClass("dragging");n(document).on("mouseup touchend",i,et);n(document).on("mousemove touchmove",i,ft);n(this).parent().find("div").removeClass("selected");n(this).parent().parent().find(".colpick_recent div").removeClass("selected");t.type=="touchstart"?(pageX=t.originalEvent.changedTouches[0].pageX,u=t.originalEvent.changedTouches[0].pageY):(pageX=t.pageX,u=t.pageY);c.apply(i.cal.data("colpick").fields.eq(6).val(parseInt(100*(i.cal.data("colpick").height-(u-i.pos.top))/i.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*(pageX-i.pos.left)/i.cal.data("colpick").height,10)).get(0),[i.preview])},kt=function(t){var i,r;t.preventDefault?t.preventDefault():t.returnValue=!1;i={cal:n(this).parent().parent(),color:h(n(this).css("backgroundColor"))};n(this).parent().find("div").removeClass("selected");n(this).parent().parent().find(".colpick_recent .recent").removeClass("selected");n(this).addClass("selected");n(i.cal.data("colpick").el).colpickSetColor(i.color);r=new Date;r-y<300&&g(t);y=r},dt=function(t){var i,r;t.preventDefault?t.preventDefault():t.returnValue=!1;i={cal:n(this).parent().parent().parent(),color:h(n(this).css("backgroundColor"))};n(this).parent().parent().find("div").removeClass("selected");n(this).parent().parent().parent().find(".colpick_preset_colors div").removeClass("selected");n(this).addClass("selected");n(i.cal.data("colpick").el).colpickSetColor(i.color);r=new Date;r-y<300&&g(t);y=r},ft=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1;var i;t.type=="touchmove"?(pageX=t.originalEvent.changedTouches[0].pageX,i=t.originalEvent.changedTouches[0].pageY):(pageX=t.pageX,i=t.pageY);n(this).parent().find("div").removeClass("selected");n(this).parent().parent().find(".colpick_recent div").removeClass("selected");c.apply(t.data.cal.data("colpick").fields.eq(6).val(parseInt(100*(t.data.cal.data("colpick").height-Math.max(0,Math.min(t.data.cal.data("colpick").height,i-t.data.pos.top)))/t.data.cal.data("colpick").height,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(t.data.cal.data("colpick").height,pageX-t.data.pos.left))/t.data.cal.data("colpick").height,10)).get(0),[t.data.preview])},et=function(i){var u=i.data.cal.data("colpick");return u.selector.closest(".colpick").removeClass("dragging"),t(u.color,i.data.cal.get(0)),r(u.color,i.data.cal.get(0)),n(document).off("mouseup touchend",et),n(document).off("mousemove touchmove",ft),!1},g=function(t){var f=n(t.target).parents(".colpick"),r=f.data("colpick").color,s;r.a=parseInt(f.find(".colpick_alpha_field input").val())/100;f.data("colpick").origColor=r;b(r,f.get(0));s=e(r);o.drawningboard.addrecentcolor(s);f.data("colpick").onSubmit(r,i(r),u(r),e(r),f.data("colpick").el);f.slideUp("fast")},ot=function(t){var i,r;t.stopPropagation();i=n("#"+n(this).data("colpickId"));i.data("colpick").onBeforeShow.apply(this,[i]);var f=n(this).offset(),h=f.top+this.offsetHeight,u=f.left,e=gt(),s=i.width();for(u+s>e.l+e.w&&(u-=s),i.css({left:u+"px",top:h+"px"}),i.data("colpick").onShow.apply(this,[i.get(0)])==!1||i.dragging||i.finish().slideDown("fast"),r=1;r<=o.drawningboard.recentcolors.length&&r<=6;r++)n(".recent"+r).css("background-color","rgba("+o.drawningboard.recentcolors[r-1].r+","+window.drawningboard.recentcolors[r-1].g+","+window.drawningboard.recentcolors[r-1].b+","+window.drawningboard.recentcolors[r-1].a+")");i.on(d,function(n){n.preventDefault();n.stopPropagation()});n("html").on(d,{cal:i},st)},st=function(t){var i,r,u;t.preventDefault();t.data.cal.data("colpick")&&t.data.cal.data("colpick").onHide.apply(this,[t.data.cal.get(0)])!=!1&&t.data.cal.finish().slideUp("fast");t.data.cal.find(".colpick_preset_colors div").removeClass("selected");t.data.cal.find(".colpick_recent div").removeClass("selected");t.data.cal.data("colpick")&&(i=t.data.cal.data("colpick").color,i.a=parseInt(t.data.cal.find(".colpick_alpha_field input").val())/100,r=t.data.cal.data("colpick").origColor,r&&i.h==r.h&&i.s==r.s&&i.b==r.b&&i.a==r.a||(t.data.cal.data("colpick").origColor=i,u=e(i),window.drawningboard.addrecentcolor(u)),n("html").off(d,st))},gt=function(){var n=document.compatMode=="CSS1Compat";return{l:window.pageXOffset||(n?document.documentElement.scrollLeft:document.body.scrollLeft),w:window.innerWidth||(n?document.documentElement.clientWidth:document.body.clientWidth)}},nt=function(n){return{h:Math.min(360,Math.max(0,n.h)),s:Math.min(100,Math.max(0,n.s)),b:Math.min(100,Math.max(0,n.b)),a:n.a}},ni=function(n){return{r:Math.min(255,Math.max(0,n.r)),g:Math.min(255,Math.max(0,n.g)),b:Math.min(255,Math.max(0,n.b))}},ti=function(n){var r=6-n.length,t,i;if(r>0){for(t=[],i=0;i<r;i++)t.push("0");t.push(n);n=t.join("")}return n},ht=function(t){if(t){var i=t.origColor;i&&n(t.el).colpickSetColor(i)}};return{init:function(i){return i=n.extend({},at,i||{}),this.each(function(){var f,e,l,u,o,y;if(!n(this).data("colpickId")){f=n.extend({},i);e="touchstart mousedown";l=f.id?"colorpicker_"+f.id:"colorpicker_"+parseInt(Math.random()*1e3);n(this).data("colpickId",l);u=n(lt).attr("id",l);u.addClass("colpick_"+f.layout+(f.submit?"":" colpick_"+f.layout+"_ns"));f.colorScheme!="light"&&u.addClass("colpick_"+f.colorScheme);f.showdelete||u.find(".colpick_buttoms .delete-td").hide();f.backgroundPicker||u.find(".colpick_use_background").hide();u.find(".colpick_buttoms .select").click(g);f.fields=u.find("input").not(".colpick_alpha_input").change(c).blur(vt).focus(yt);u.find("div.colpick_field_arrs").mousedown(pt).end().find("div.colpick_current_color").click(ht);f.selector=u.find("div.colpick_color").on(e,bt);u.find(".colpick_preset_colors div").on(e,kt);u.find(".colpick_recent .recent").on(e,dt);u.find(".colpick_use_background").on("click",function(){var t=n(this).find(".fa");if(t.hasClass("fa-check-square-o")){t.removeClass("fa-check-square-o");t.addClass("fa-square-o");f.onUseBackground(!1)}else{t.addClass("fa-check-square-o");t.removeClass("fa-square-o");f.onUseBackground(!0)}});u.find(".colpick_alpha_slider").slider({min:0,max:100,range:"min",value:100,slide:function(t,i){u.find(".colpick_alpha_field input").val(i.value+"%");var r={cal:n(this).parent()};n(r.cal.data("colpick").el).colpickSetOpacity(parseFloat(i.value/100))}});u.find(".colpick_alpha_slider").slider("value",parseInt(i.color.a*100));u.find(".colpick_alpha_field input").val(parseInt(i.color.a*100));u.find(".colpick_alpha_field input").pctspinner();f.selectorIndic=f.selector.find("div.colpick_selector_outer");f.el=this;f.hue=u.find("div.colpick_hue_arrs");f.color=f.origColor=h(n(f.el).css("background-color"));huebar=f.hue.parent();var d=navigator.userAgent.toLowerCase(),v=navigator.appName==="Microsoft Internet Explorer",nt=v?parseFloat(d.match(/msie ([0-9]{1,}[\.0-9]{0,})/)[1]):0,tt=v&&nt<10,s=["#ff0000","#ff0080","#ff00ff","#8000ff","#0000ff","#0080ff","#00ffff","#00ff80","#00ff00","#80ff00","#ffff00","#ff8000","#ff0000"];if(tt)for(o=0;o<=11;o++)y=n("<div><\/div>").attr("style","height:8.333333%; filter:progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr="+s[o]+", endColorstr="+s[o+1]+'); -ms-filter: "progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='+s[o]+", endColorstr="+s[o+1]+')";'),huebar.append(y);else stopList=s.join(","),huebar.attr("style","background:-webkit-linear-gradient(top,"+stopList+"); background: -o-linear-gradient(top,"+stopList+"); background: -ms-linear-gradient(top,"+stopList+"); background:-moz-linear-gradient(top,"+stopList+"); -webkit-linear-gradient(top,"+stopList+"); background:linear-gradient(to bottom,"+stopList+"); ");u.find("div.colpick_hue").on(e,wt);f.newColor=u.find("div.colpick_new_color");f.newColorBg=u.find("div.colpick_new_color_bg");f.currentColor=u.find("div.colpick_current_color");u.find(".colpick_buttoms .cancel, .colpick_close").on(e,function(n){n.preventDefault?n.preventDefault():n.returnValue=!1;u.slideUp("fast");ht(u.data("colpick"))});u.find(".colpick_buttoms .delete").on(e,function(n){n.preventDefault?n.preventDefault():n.returnValue=!1;u.slideUp("fast");u.data("colpick").onDelete.apply(u.parent(),[u.data("colpick").el,u])});if(u.data("colpick",f),t(f.color,u.get(0)),a(f.color,u.get(0)),r(f.color,u.get(0)),w(f.color,u.get(0)),p(f.color,u.get(0)),b(f.color,u.get(0)),k(f.color,u.get(0)),f.flat)u.appendTo(this).slideDown(),u.css({position:"relative",display:"block"});else{u.appendTo(document.body);n(this).on(f.showEvent,ot);u.css({position:"absolute"})}}})},showPicker:function(){return this.each(function(){n(this).data("colpickId")&&ot.apply(this)})},hidePicker:function(){return this.each(function(){n(this).data("colpickId")&&n("#"+n(this).data("colpickId")).hide()})},setColor:function(o,h){if(h=typeof h=="undefined"?1:h,typeof o=="string")o=s(o);else if(o.r!=undefined&&o.g!=undefined&&o.b!=undefined&&o.a!=undefined)o=l(o);else if(o.r!=undefined&&o.g!=undefined&&o.b!=undefined)o=f(o);else if(o.h!=undefined&&o.s!=undefined&&o.b!=undefined)o=nt(o);else return this;return this.each(function(){var f,s;n(this).data("colpickId")&&(f=n("#"+n(this).data("colpickId")),f.data("colpick").color=o,t(o,f.get(0)),a(o,f.get(0)),r(o,f.get(0)),w(o,f.get(0)),p(o,f.get(0)),s=o?o.a:1,f.find(".colpick_new_color").css("opacity",s),f.find(".colpick_alpha_slider").slider("value",parseInt(s*100)),f.find(".colpick_alpha_field input").val(parseInt(s*100)+"%"),k(o,f.get(0)),f.data("colpick").onChange.apply(f.parent(),[o,i(o),u(o),e(o),f.data("colpick").el,1]),h&&b(o,f.get(0)))})},setOriginal:function(i,u){if(u=typeof u=="undefined"?1:u,i)if(typeof i=="string")i=s(i);else if(i.r!=undefined&&i.g!=undefined&&i.b!=undefined&&i.a!=undefined)i=l(i);else if(i.r!=undefined&&i.g!=undefined&&i.b!=undefined)i=f(i);else if(i.h!=undefined&&i.s!=undefined&&i.b!=undefined)i=nt(i);else return this;else i=undefined;return this.each(function(){var f,o,e;n(this).data("colpickId")&&(f=n("#"+n(this).data("colpickId")),i?(o=i.a,e=i):(o=1,e={h:0,s:0,b:0,a:1}),f.find(".colpick_new_color").css("opacity",o),f.find(".colpick_alpha_slider").slider("value",parseInt(o*100)),f.find(".colpick_alpha_field input").val(parseInt(o*100)+"%"),f.data("colpick").color=e,f.data("colpick").origColor=i,t(i,f.get(0)),a(i,f.get(0)),r(i,f.get(0)),w(e,f.get(0)),p(e,f.get(0)),k(i,f.get(0)),u&&b(e,f.get(0)))})},setOpacity:function(t){return this.each(function(){if(n(this).data("colpickId")){var i=n("#"+n(this).data("colpickId"));i.data("colpick").color.a=t;i.find(".colpick_new_color").css("opacity",t);n(i.data("colpick").el).colpickSetColor(i.data("colpick").color)}})}}}(),c=function(n){var n=parseInt(n.indexOf("#")>-1?n.substring(1):n,16);return{r:n>>16,g:(n&65280)>>8,b:n&255}},p=function(n){var n=parseInt(n.indexOf("#")>-1?n.substring(1):n,16);return{r:n>>16,g:(n&65280)>>8,b:n&255,a:1}},s=function(n){return f(c(n))},f=function(n){var t={h:0,s:0,b:0},u=Math.min(n.r,n.g,n.b),i=Math.max(n.r,n.g,n.b),r=i-u;return t.b=i,t.s=i!=0?255*r/i:0,t.h=t.s!=0?n.r==i?(n.g-n.b)/r:n.g==i?2+(n.b-n.r)/r:4+(n.r-n.g)/r:-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t.a=n.a,t},l=function(n){var t={h:0,s:0,b:0},u=Math.min(n.r,n.g,n.b),i=Math.max(n.r,n.g,n.b),r=i-u;return t.b=i,t.s=i!=0?255*r/i:0,t.h=t.s!=0?n.r==i?(n.g-n.b)/r:n.g==i?2+(n.b-n.r)/r:4+(n.r-n.g)/r:-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t.a=n.a,t},u=function(n){var t={};if(n)var i=n.h,o=n.s*255/100,e=n.b*255/100;else var i=0,o=0,e=0;if(o==0)t.r=t.g=t.b=e;else{var r=e,u=(255-o)*e/255,f=(r-u)*(i%60)/60;i==360&&(i=0);i<60?(t.r=r,t.b=u,t.g=u+f):i<120?(t.g=r,t.b=u,t.r=r-f):i<180?(t.g=r,t.r=u,t.b=u+f):i<240?(t.b=r,t.r=u,t.g=r-f):i<300?(t.b=r,t.g=u,t.r=u+f):i<360?(t.r=r,t.g=u,t.b=r-f):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},e=function(n){var t={};if(n)var i=n.h,o=n.s*255/100,e=n.b*255/100,s=n.a;else var i=0,o=0,e=0,s=1;if(o==0)t.r=t.g=t.b=e;else{var r=e,u=(255-o)*e/255,f=(r-u)*(i%60)/60;i==360&&(i=0);i<60?(t.r=r,t.b=u,t.g=u+f):i<120?(t.g=r,t.b=u,t.r=r-f):i<180?(t.g=r,t.r=u,t.b=u+f):i<240?(t.b=r,t.r=u,t.g=r-f):i<300?(t.b=r,t.g=u,t.r=u+f):i<360?(t.r=r,t.g=u,t.b=r-f):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b),a:s}},a=function(t){var i=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return n.each(i,function(n,t){t.length==1&&(i[n]="0"+t)}),i.join("")},i=function(n){return a(u(n))},h=function(n){var t;return n.indexOf("rgba")>=0?(n=n.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*(\d*\.*\d+)\)$/),t={r:parseInt(n[1]),g:parseInt(n[2]),b:parseInt(n[3]),a:parseFloat(n[4])}):n=="transparent"?t={r:255,g:255,b:255,a:0}:(t=y(n),t.a=1),t},y=function(n){n=n.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return{r:parseInt(n[1]),g:parseInt(n[2]),b:parseInt(n[3])}};n.fn.extend({colpick:r.init,colpickHide:r.hidePicker,colpickShow:r.showPicker,colpickSetColor:r.setColor,colpickSetOriginal:r.setOriginal,colpickSetOpacity:r.setOpacity});n.extend({colpick:{stringToRgba:h,rgbToHex:a,rgbToHsb:f,hsbToHex:i,hsbToRgb:u,hexToHsb:s,hexToRgb:c}})}})(jQuery)